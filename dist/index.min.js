!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ProfullstackSpaRouter={})}(this,(function(e){"use strict";const t=e=>{if(!e.includes(":"))return{regex:new RegExp(`^${e}$`),paramNames:[]};const t=(e.match(/:[^\s/]+/g)||[]).map((e=>e.slice(1))),n=e.replace(/:[^\s/]+/g,"([^/]+)").replace(/\//g,"\\/");return{regex:new RegExp(`^${n}$`),paramNames:t}},n=(e,t,n)=>{const o=e.match(t);if(!o)return null;const r={};return n.forEach(((e,t)=>{r[e]=o[t+1]})),r},o=e=>("/"!==(e=e||"/")&&e.endsWith("/")&&(e=e.slice(0,-1)),""===e&&(e="/"),e),r=e=>{const t=e.composedPath();for(let e=0;e<t.length;e++)if("A"===t[e].tagName)return t[e];return null},i=e=>{const t=e.getAttribute("href");return!!t&&(!t.startsWith("http")&&!t.startsWith("//")&&(!e.hasAttribute("target")&&(!e.hasAttribute("download")&&(!t.startsWith("#")&&!t.match(/\.\w+$/)))))};var s={pathToRegex:t,extractParams:n,normalizePath:o,findAnchorInPath:r,shouldHandleLink:i},a=Object.freeze({__proto__:null,default:s,extractParams:n,findAnchorInPath:r,normalizePath:o,pathToRegex:t,shouldHandleLink:i});const l=()=>async(e,t,n)=>(n.innerHTML=t,Promise.resolve()),c=(e={})=>{const t=e.duration||150,n=e.onComplete||(()=>{});return async(e,o,r)=>new Promise((e=>{const i=document.createElement("div");i.className="transition-overlay",i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100vw",i.style.height="100vh",i.style.backgroundColor="var(--background-color, #ffffff)",i.style.zIndex="9999",i.style.opacity="0",i.style.transition=`opacity ${t}ms ease-in-out`,document.body.appendChild(i),setTimeout((()=>{i.style.opacity="1"}),0),setTimeout((()=>{o instanceof DocumentFragment?(r.innerHTML="",r.appendChild(o.cloneNode(!0))):"string"==typeof o?r.innerHTML=o:(console.error("Unsupported content type:",typeof o),r.innerHTML=String(o)),i.style.opacity="0",setTimeout((()=>{document.body.contains(i)&&document.body.removeChild(i),n();document.querySelectorAll(".transition-overlay").forEach((e=>{document.body.contains(e)&&e!==i&&(console.log("Removing stale transition overlay"),document.body.removeChild(e))})),e()}),t)}),t),setTimeout((()=>{document.body.contains(i)&&(console.log("Safety timeout: removing transition overlay"),document.body.removeChild(i))}),3*t)}))},d=(e={})=>{const t=e.direction||"left",n=e.duration||300;return async(e,o,r)=>new Promise((i=>{const s=document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.transition=`transform ${n}ms ease-in-out`,"string"==typeof e?s.innerHTML=e:(console.warn("Old content is not a string, using empty content"),s.innerHTML="");const a=document.createElement("div");a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.transition=`transform ${n}ms ease-in-out`,o instanceof DocumentFragment?a.appendChild(o.cloneNode(!0)):"string"==typeof o?a.innerHTML=o:(console.error("Unsupported content type:",typeof o),a.innerHTML=String(o));let l="",c="";switch(t){case"left":l="translateX(100%)",c="translateX(-100%)";break;case"right":l="translateX(-100%)",c="translateX(100%)";break;case"up":l="translateY(100%)",c="translateY(-100%)";break;case"down":l="translateY(-100%)",c="translateY(100%)"}a.style.transform=l,r.innerHTML="",r.style.position="relative",r.style.overflow="hidden",r.appendChild(s),r.appendChild(a),setTimeout((()=>{s.style.transform=c,a.style.transform="translateX(0)",setTimeout((()=>{r.innerHTML="",o instanceof DocumentFragment?r.appendChild(o.cloneNode(!0)):"string"==typeof o?r.innerHTML=o:(console.error("Unsupported content type:",typeof o),r.innerHTML=String(o)),r.style.position="",r.style.overflow="",i()}),n)}),10)}))},u=e=>async(t,n,o)=>e(t,n,o);var p={none:l,fade:c,slide:d,custom:u},h=Object.freeze({__proto__:null,custom:u,default:p,fade:c,none:l,slide:d});class m{constructor(e={}){this.routes={},this.rootElement=e.rootElement||"#app",this.errorHandler=e.errorHandler||this.defaultErrorHandler,this.transition=e.transition||c({duration:150}),this.currentRoute=null,this.loading=!1,this.middlewares=[],e.routes&&this.registerRoutes(e.routes),this.init()}init(){console.log("Router initializing..."),"complete"!==document.readyState&&"interactive"!==document.readyState||(console.log("Document already loaded, navigating to:",window.location.pathname),this.navigate(window.location.pathname,!1)),window.addEventListener("DOMContentLoaded",(()=>{console.log("DOMContentLoaded event, navigating to:",window.location.pathname),this.navigate(window.location.pathname,!1)})),window.addEventListener("popstate",(e=>{console.log("Popstate event, navigating to:",window.location.pathname),this.navigate(window.location.pathname,!1)})),document.addEventListener("click",(e=>{if(e.metaKey||e.ctrlKey||e.shiftKey)return;const t=r(e);if(!t)return;if(!i(t))return;const n=t.getAttribute("href");e.preventDefault(),this.navigate(n),console.log("Intercepted click on link:",n)}),{capture:!0})}registerRoutes(e){Object.entries(e).forEach((([e,t])=>{this.addRoute(e,t)}))}addRoute(e,n){const{regex:o,paramNames:r}=t(e);this.routes[e]={...n,regex:o,paramNames:r,path:e}}removeRoute(e){delete this.routes[e]}getCurrentRoute(){return this.currentRoute}back(){window.history.back()}forward(){window.history.forward()}use(e){this.middlewares.push(e)}async navigate(e,t=!0){if(console.log(`Router navigating to: ${e}`),this.loading)return void console.log("Already loading, skipping navigation");this.loading=!0,e=o(e);const n=this.findRoute(e);console.log("Found route:",n?"yes":"no"),t&&(console.log("Updating history with path:",e),window.history.pushState({path:e},document.title,e));const r=document.querySelector(this.rootElement);if(!r)return console.error(`Root element "${this.rootElement}" not found`),void(this.loading=!1);try{const t=r.innerHTML;if(n){const o=this.currentRoute?this.currentRoute.path:null,i={path:e,params:n.params};let s=0;const a=async e=>{if(e)return this.loading=!1,this.navigate(e);if(s<this.middlewares.length){return(0,this.middlewares[s++])(i,o,a)}return this.renderRoute(n,r,t)};await a()}else{console.log("Route not found, showing 404 page");const n=this.errorHandler(e,r);await this.transition(t,n,r),setTimeout((()=>{document.querySelectorAll(".transition-overlay").forEach((e=>{document.body.contains(e)&&document.body.removeChild(e)})),document.dispatchEvent(new CustomEvent("error-page-rendered",{detail:{path:e}}))}),100)}}catch(e){console.error("Error rendering route:",e),r.innerHTML=`<div class="error">Error loading page: ${e.message}</div>`}finally{this.loading=!1}}async renderRoute(e,t,n){let o;if(this.currentRoute=e,e.beforeEnter){const t=e=>!e||(this.loading=!1,this.navigate(e));if(!1===await e.beforeEnter(e,this.currentRoute,t))return void(this.loading=!1)}try{if("function"==typeof e.view)console.log("Calling view function with params:",e.params),o=await e.view(e.params);else if("string"==typeof e.view)console.log("Using string view"),o=e.view;else if(e.component){if(console.log("Creating component:",e.component),"string"==typeof e.component){const t=document.createElement(e.component);e.props&&Object.entries(e.props).forEach((([e,n])=>{t[e]=n})),o=t.outerHTML}else if("function"==typeof e.component){const t=await e.component(),n=new(t.default||t)(e.props);o=n.render?n.render():n.outerHTML}}else console.log("No view or component found, using empty content"),o="";if(await this.transition(n,o,t),e.afterRender){console.log("Calling afterRender function");try{e.afterRender(e.params)}catch(e){console.error("Error in afterRender:",e)}}window.dispatchEvent(new CustomEvent("route-changed",{detail:{path:e.path,route:e}}));const r=document.getElementById("initial-loading-overlay");r&&(r.style.opacity="0",setTimeout((()=>{r.parentNode&&r.parentNode.removeChild(r)}),150))}catch(e){throw console.error("Error rendering route content:",e),e}}findRoute(e){if(this.routes[e])return{...this.routes[e]};if("/"===e&&this.routes["/"])return{...this.routes["/"]};for(const t in this.routes){const o=this.routes[t];if(!t.includes(":"))continue;const r=n(e,o.regex,o.paramNames);if(r)return{...o,params:r}}return null}defaultErrorHandler(e){return`\n      <div class="error-page">\n        <h1>404 - Page Not Found</h1>\n        <p>The page "${e}" could not be found.</p>\n        <a href="/" class="back-link">Go back to home</a>\n      </div>\n    `}}function f(e){const t=Array.from(e.body.querySelectorAll('script[type="module"]')),n=Array.from(e.querySelectorAll('script[type="module"]')),o=[...new Set([...t,...n])].map((e=>e.getAttribute("src"))).filter((e=>e));return o.length>0&&console.log(`Found ${o.length} module scripts:`,o),o}async function g(e){return function(e){const t=e.querySelectorAll("script:not([src])");let n=t.length;return t.forEach((e=>{const t=document.createElement("script");[...e.attributes].forEach((e=>t.setAttribute(e.name,e.value))),t.textContent=e.textContent,e.replaceWith(t)})),n}}function y(e,t=!1){const n=document.createElement("div");return Array.from(e.children).forEach((e=>{(t||"SCRIPT"!==e.tagName)&&n.appendChild(e.cloneNode(!0))})),n}function w(e){const t=Array.from(e.querySelectorAll("script"));return t.length>0&&console.log(`Found ${t.length} script tags to clone`),t.map((e=>{const t=document.createElement("script");if(Array.from(e.attributes).forEach((e=>{t.setAttribute(e.name,e.value)})),t.textContent=e.textContent,t.src&&!t.src.startsWith("http://")&&!t.src.startsWith("https://")){const e=window.location.origin,n=t.src.startsWith("/")?`${e}${t.src}`:`${e}/${t.src}`;t.src=n}return t}))}function v(e){const t=document.createDocumentFragment();Array.from(e.body.children).forEach((e=>{"SCRIPT"!==e.tagName&&t.appendChild(e.cloneNode(!0))}));w(e).forEach((e=>{t.appendChild(e)}));const n=f(e);return n&&n.length>0&&(console.log(`Adding ${n.length} module scripts to the fragment`),n.forEach((e=>{const n=document.createElement("script");if(n.type="module",e.startsWith("http://")||e.startsWith("https://"))n.src=e;else{const t=window.location.origin,o=e.startsWith("/")?`${t}${e}`:`${t}/${e}`;n.src=o}console.log(`Adding module script: ${n.src}`),t.appendChild(n)}))),t}var E={extractModuleScriptSources:f,executeInlineScripts:g,filterScriptTags:y,extractAndCloneScripts:w,createFragmentWithScripts:v},b=Object.freeze({__proto__:null,createFragmentWithScripts:v,default:E,executeInlineScripts:g,extractAndCloneScripts:w,extractModuleScriptSources:f,filterScriptTags:y});function C(e={}){const t=e.translateContainer||(e=>{}),n=e.applyRTLToDocument||(()=>{}),o=!1!==e.handleScripts,r=!0===e.keepScripts;return async(e,i)=>{const s=document.createElement("div");let a,l;if(s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.opacity="0",s.style.zIndex="1",e instanceof DocumentFragment){console.log("Received DocumentFragment as content"),a=document.implementation.createHTMLDocument("");const t=e.cloneNode(!0);a.body.appendChild(t)}else{if("string"!=typeof e)throw console.error("Unsupported content type:",typeof e),new Error("Unsupported content type: "+typeof e);{console.log("Received string as content");const t=new DOMParser;a=t.parseFromString(e,"text/html")}}let c=[],d=[];if(o)if(c=f(a),l=await g(),r)console.log("Collecting script tags to properly insert them later"),d=Array.from(a.querySelectorAll("script")).map((e=>{const t=document.createElement("script");return Array.from(e.attributes).forEach((e=>{t.setAttribute(e.name,e.value)})),t.textContent=e.textContent,e.parentNode&&e.parentNode.removeChild(e),t})),console.log(`Collected ${d.length} script elements`);else{const e=y(a.body,!1);for(;a.body.firstChild;)a.body.removeChild(a.body.firstChild);Array.from(e.children).forEach((e=>{a.body.appendChild(e)}))}const u={};i.querySelectorAll("*").filter((e=>e.tagName.includes("-"))).forEach((e=>{const t=e.tagName.toLowerCase();u[t]=e})),Array.from(a.body.children).forEach((e=>{e.tagName.includes("-")&&u[e.tagName.toLowerCase()]?console.log(`Preserving existing component: ${e.tagName.toLowerCase()}`):s.appendChild(e)})),t&&t(s),Object.values(u).forEach((e=>{s.appendChild(e)})),i.appendChild(s),n&&n(),setTimeout((()=>{if(Array.from(i.children).forEach((e=>{e!==s&&i.removeChild(e)})),s.style.position="relative",s.style.opacity="1",l&&(console.log("Executing inline scripts"),l(s)),d&&d.length>0&&(console.log(`Inserting ${d.length} script elements into the DOM`),d.forEach((e=>{if("module"===e.type?console.log(`Inserting module script: ${e.src||"inline"}`):console.log(`Inserting regular script: ${e.src||"inline"}`),e.src&&!e.src.startsWith("http://")&&!e.src.startsWith("https://")){const t=window.location.origin,n=e.src.startsWith("/")?`${t}${e.src}`:`${t}/${e.src}`;e.src=n}document.head.appendChild(e)}))),c.length>0){console.log("Importing module scripts after DOM update");const e=window.location.origin;c.forEach((t=>{const n=document.createElement("script");if(n.type="module",t.startsWith("http://")||t.startsWith("https://"))n.src=t;else{const o=t.startsWith("/")?`${e}${t}`:`${e}/${t}`;n.src=o}console.log(`Loading module script: ${n.src}`),document.head.appendChild(n)}))}window.dispatchEvent(new CustomEvent("spa-transition-end"))}),50)}}function R(e={}){return e=>`\n      <div class="error-page">\n        <h1>404 - Page Not Found</h1>\n        <p>The page "${e}" could not be found.</p>\n        <a href="/" class="back-link">Go back to home</a>\n      </div>\n    `}var $={createRenderer:C,createErrorHandler:R},T=Object.freeze({__proto__:null,createErrorHandler:R,createRenderer:C,default:$}),A={Router:m,transitions:h,utils:a,renderer:T,componentLoader:b};e.Router=m,e.componentLoader=b,e.default=A,e.renderer=T,e.transitions=h,e.utils=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.min.js.map
